name: Build

on: [push, pull_request, workflow_dispatch]

jobs:
  Build:
    name: Mac OS X
    runs-on: macos-latest 

    defaults:
      run:
        shell: sh

    strategy:
      fail-fast: false         

    steps:
    - name: Setup Dependencies
      run: |
        brew install \
          autoconf \
          ninja \
          pkg-config

    - uses: actions/checkout@v4
    - name: Configure
      run: |
        cmake -S . -B build -G Ninja \
        -DSDL_VENDOR_INFO="Github Workflow" \
        -DCMAKE_INSTALL_PREFIX=cmake_prefix \
        -DCMAKE_BUILD_TYPE=Release \
        -DCMAKE_C_COMPILER_WORKS=1 \
        -DCMAKE_CXX_COMPILER_WORKS=1 \
        -DCMAKE_OBJC_COMPILER_WORKS=1 \
        -DCMAKE_OSX_ARCHITECTURES="arm64"
    - name: Build
      run: |
        cmake --build build/ --config Release --parallel
    - name: Install
      run: |
        set -eu
        cmake --install build/ --config Release
        echo "SDL2_DIR=$(pwd)/cmake_prefix" >> $GITHUB_ENV
        ( cd cmake_prefix; find ) | LC_ALL=C sort -u
    - name: Upload
      uses: actions/upload-artifact@v4.3.3
      with:
        path: build/libSDL2-2.0.0.dylib
                
